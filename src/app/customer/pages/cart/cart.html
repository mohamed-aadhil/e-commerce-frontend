<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-primary-dark">Your Shopping Cart</h1>
  
  <div class="flex flex-col md:flex-row gap-6">
    <div class="flex-1 space-y-4">
      <ng-container *ngIf="cart$ | async as cart; else loading">
        <ng-container *ngIf="cart.items?.length; else emptyCart">
          <mat-card *ngFor="let item of cart.items" class="flex flex-col sm:flex-row items-center p-4 shadow-md rounded-lg">
            <div class="flex flex-col sm:flex-row items-center gap-4 flex-grow">
              <a [routerLink]="['/products', item.product.id]">
                <img 
                  [src]="item.product.images?.[0] || 'assets/images/placeholder.jpg'" 
                  [alt]="item.product.title" 
                  class="w-24 h-24 object-cover rounded-md flex-shrink-0"
                >
              </a>
              <div class="flex-grow text-center sm:text-left">
                <h3 class="text-lg font-semibold mb-1">
                  <a [routerLink]="['/products', item.product.id]" class="product-link text-primary-dark hover:underline">
                    {{ item.product.title }}
                  </a>
                </h3>
                <p class="text-primary font-medium mb-2">{{ item.price | currency:'INR' }}</p>
                <p class="text-sm" [ngClass]="getStockStatus(item.product.inventory.quantity).class">
                  {{ getStockStatus(item.product.inventory.quantity).text }}
                </p>
                <div class="flex items-center gap-2 mt-2 justify-center sm:justify-start">
                  <button 
                    mat-icon-button 
                    (click)="updateQuantity(item.product.id, item.quantity - 1)"
                    [disabled]="isUpdating"
                  >
                    <mat-icon>remove</mat-icon>
                  </button>
                  <span class="mx-2 font-medium">{{ item.quantity }}</span>
                  <button 
                    mat-icon-button 
                    (click)="updateQuantity(item.product.id, item.quantity + 1)"
                    [disabled]="isUpdating || item.quantity >= (item.product.inventory.quantity || 0)"
                  >
                    <mat-icon>add</mat-icon>
                  </button>
                  <button 
                    mat-button 
                    color="warn" 
                    (click)="removeItem(item.product.id)"
                    [disabled]="isUpdating"
                    class="ml-4"
                  >
                    Remove
                  </button>
                </div>
              </div>
            </div>
            <div class="font-bold text-lg sm:ml-auto mt-4 sm:mt-0 whitespace-nowrap">
              {{ (item.price * item.quantity) | currency:'INR' }}
            </div>
          </mat-card>
        </ng-container>
      </ng-container>
    </div>

    <mat-card class="w-full md:w-1/3 p-4 shadow-md rounded-lg">
      <h2 class="text-xl font-bold mb-4 text-primary-dark">Order Summary</h2>
      <mat-divider></mat-divider>
      
      <div class="flex justify-between items-center py-2 text-slate-700">
        <span>Subtotal</span>
        <span>{{ getCartValue() | currency:'INR' }}</span>
      </div>
      <div class="flex justify-between items-center py-2 text-slate-700">
        <span>Shipping</span>
        <span>Calculated at checkout</span>
      </div>
      
      <mat-divider></mat-divider>
      
      <div class="flex justify-between items-center py-2 text-slate-700 font-bold text-lg text-primary">
        <span>Total</span>
        <span>{{ getCartValue() | currency:'INR' }}</span>
      </div>
      
      <button 
        mat-flat-button 
        color="primary" 
        class="w-full py-3 mt-4 text-lg bg-primary text-white hover:bg-primary-dark transition"
        [disabled]="!(cart$ | async)?.items?.length || isCheckingOut"
        (click)="onCheckout()"
      >
        <span *ngIf="!isCheckingOut">Proceed to Checkout</span>
        <div *ngIf="isCheckingOut" class="button-loading flex items-center justify-center gap-2">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
          <span>Processing...</span>
        </div>
      </button>
      
      <button 
        mat-button 
        color="primary" 
        class="w-full py-3 mt-2 text-primary border border-primary hover:bg-primary hover:text-white transition"
        (click)="continueShopping()"
      >
        Continue Shopping
      </button>
    </mat-card>
  </div>
  
  <!-- Login Modal -->
  <app-login
    *ngIf="showLoginModal"
    [isModal]="true"
    (close)="onLoginModalClose()"
    (switchToSignup)="onSwitchToSignup()">
  </app-login>
  
  <!-- Signup Modal -->
  <app-signup
    *ngIf="showSignupModal"
    [isModal]="true"
    (close)="onSignupModalClose($event)"
    (switchToLogin)="onSwitchToLogin()">
  </app-signup>
</div>

<ng-template #loading>
  <div class="flex justify-center items-center h-64">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>

<ng-template #emptyCart>
  <mat-card class="flex flex-col items-center justify-center p-8 text-center text-slate-500 rounded-lg shadow-md mt-8 max-w-md mx-auto">
    <mat-icon class="w-16 h-16 text-slate-400 mb-4">remove_shopping_cart</mat-icon>
    <h2 class="text-xl font-semibold mb-2">Your cart is empty</h2>
    <p class="mb-4">Looks like you haven't added anything to your cart yet</p>
    <button 
      mat-flat-button 
      color="primary" 
      class="bg-primary text-white py-2 px-6 hover:bg-primary-dark transition"
      (click)="continueShopping()"
    >
      Continue Shopping
    </button>
  </mat-card>
</ng-template>
